!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("THREE")):"function"==typeof define&&define.amd?define(["THREE"],t):"object"==typeof exports?exports.Zinc=t(require("THREE")):e.Zinc=t(e.THREE)}(window,function(e){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){i(1);var n={REVISION:"28",defaultMaterialColor:8331034,defaultOpacity:1};n.Geometry=i(2).Geometry,n.Glyph=i(3).Glyph,n.Glyphset=i(4).Glyphset,n.Renderer=i(5).Renderer,n.Scene=i(6).Scene,n.Viewport=i(7).Viewport,n.CameraControls=i(7).CameraControls,n.SmoothCameraTransition=i(7).SmoothCameraTransition,n.RayCaster=i(7).RayCaster,n.CameraAutoTumble=i(7).CameraAutoTumble,n.loadExternalFile=i(8).loadExternalFile,n.loadExternalFiles=i(8).loadExternalFiles,e.exports=n},function(t,i){t.exports=e},function(e,t,i){var n=i(1);t.Geometry=function(){this.geometry=void 0,this.mixer=void 0,this.timeEnabled=!1,this.morphColour=!1,this.modelId=-1,this.morph=void 0,this.clipAction=void 0,this.duration=3e3,this.groupName=void 0;var e=0,t=this;this.setVisibility=function(e){t.morph.visible=e},this.setAlpha=function(e){var i=t.morph.material,n=!1;e<1&&(n=!0),i.transparent=n,i.opacity=e},this.getCurrentTime=function(){if(t.clipAction){var i=t.clipAction.time/t.clipAction._clip.duration;return t.duration*i}return e},this.setMorphTime=function(o){if(t.clipAction){var r=o/t.duration,a=t.clipAction._clip.duration;t.clipAction.time=r*a,t.clipAction.time>a&&(t.clipAction.time=a),t.clipAction.time<0&&(t.clipAction.time=0),1==t.timeEnabled&&t.mixer.update(0)}else e=o>t.duration?t.duration:0>o?0:o;1==t.morphColour&&void 0!==t.geometry&&(t.morph.material.vertexColors==n.VertexColors&&i(t.geometry,t.morph,t.clipAction),t.geometry.colorsNeedUpdate=!0)},this.calculateUVs=function(){t.geometry.computeBoundingBox();var e=t.geometry.boundingBox.max,i=t.geometry.boundingBox.min,o=new n.Vector2(0-i.x,0-i.y),r=new n.Vector2(e.x-i.x,e.y-i.y);t.geometry.faceVertexUvs[0]=[];for(var a=0;a<t.geometry.faces.length;a++){var s=t.geometry.vertices[t.geometry.faces[a].a],c=t.geometry.vertices[t.geometry.faces[a].b],u=t.geometry.vertices[t.geometry.faces[a].c];geometry.faceVertexUvs[0].push([new n.Vector2((s.x+o.x)/r.x,(s.y+o.y)/r.y),new n.Vector2((c.x+o.x)/r.x,(c.y+o.y)/r.y),new n.Vector2((u.x+o.x)/r.x,(u.y+o.y)/r.y)])}geometry.uvsNeedUpdate=!0},this.setWireframe=function(e){t.morph.material.wireframe=e},this.setVertexColors=function(e){t.morph.material.vertexColors=e,t.geometry.colorsNeedUpdate=!0},this.setColour=function(e){t.morph.material.color=e,t.geometry.colorsNeedUpdate=!0},this.setMaterial=function(e){t.morph.material=e,t.geometry.colorsNeedUpdate=!0},getColorsRGB=function(e,t){var i=Math.floor(t/3),o=t%3,r=0;0==o?r=e[i].r:1==o?r=e[i].g:2==o&&(r=e[i].b);var a=new n.Color(r);return[a.r,a.g,a.b]};var i=function(i,n,o){if(n&&i.morphColors&&i.morphColors.length){var r=0;r=o?o.time/o._clip.duration*(i.morphColors.length-1):e/t.duration*(i.morphColors.length-1);for(var a=Math.floor(r),s=1-(r-a),c=Math.ceil(r),u=i.morphColors[a],l=i.morphColors[c],d=0;d<i.faces.length;d++){var m=getColorsRGB(u.colors,i.faces[d].a),h=getColorsRGB(l.colors,i.faces[d].a),p=[m[0]*s+h[0]*(1-s),m[1]*s+h[1]*(1-s),m[2]*s+h[2]*(1-s)];i.faces[d].vertexColors[0].setRGB(p[0],p[1],p[2]),m=getColorsRGB(u.colors,i.faces[d].b),h=getColorsRGB(l.colors,i.faces[d].b),p=[m[0]*s+h[0]*(1-s),m[1]*s+h[1]*(1-s),m[2]*s+h[2]*(1-s)],i.faces[d].vertexColors[1].setRGB(p[0],p[1],p[2]),m=getColorsRGB(u.colors,i.faces[d].c),h=getColorsRGB(l.colors,i.faces[d].c),p=[m[0]*s+h[0]*(1-s),m[1]*s+h[1]*(1-s),m[2]*s+h[2]*(1-s)],i.faces[d].vertexColors[2].setRGB(p[0],p[1],p[2])}}};this.getBoundingBox=function(){if(t.morph)return(new n.Box3).setFromObject(t.morph)},this.dispose=function(){t.morph.geometry.dispose(),t.morph.material.dispose(),t.geometry=void 0,t.mixer=void 0,t.morph=void 0,t.clipAction=void 0,t.groupName=void 0,t=void 0},this.render=function(o,r){if(1==r){if(t.clipAction&&1==t.timeEnabled)t.mixer.update(o);else{var a=e+o;a>t.duration&&(a-=t.duration),e=a}if(1==t.morphColour&&void 0!==t.geometry&&t.morph.material.vertexColors==n.VertexColors){var s=void 0;t.clipAction&&1==t.timeEnabled&&(s=t.clipAction),i(t.geometry,t.morph,s),t.geometry.colorsNeedUpdate=!0}}}}},function(e,t){t.Glyph=function(e,t,i){var n=t.clone();n.vertexColors=THREE.FaceColors;var o=new THREE.Mesh(e,n);this.id=i;var r=this;this.getMesh=function(){return o},this.getBoundingBox=function(){if(o)return(new THREE.Box3).setFromObject(o)},this.setColor=function(e){o.material.color=e,o.geometry.colorsNeedUpdate=!0},this.setTransformation=function(e,t,i,n){o.matrix.elements[0]=t[0],o.matrix.elements[1]=t[1],o.matrix.elements[2]=t[2],o.matrix.elements[3]=0,o.matrix.elements[4]=i[0],o.matrix.elements[5]=i[1],o.matrix.elements[6]=i[2],o.matrix.elements[7]=0,o.matrix.elements[8]=n[0],o.matrix.elements[9]=n[1],o.matrix.elements[10]=n[2],o.matrix.elements[11]=0,o.matrix.elements[12]=e[0],o.matrix.elements[13]=e[1],o.matrix.elements[14]=e[2],o.matrix.elements[15]=1,o.matrixAutoUpdate=!1},this.dispose=function(){r.material.dispose(),r.mesh=void 0}}},function(e,t,i){var n=i(1);t.Glyphset=function(){var e=[],t=void 0,i=void 0,o=void 0,r=void 0,a=void 0,s=void 0,c=0,u=0,l=[0,0,0],d=[0,0,0],m=[0,0,0],h="NONE";this.duration=3e3;var p=0;this.ready=!1;var f=new n.Group,v=this,g=!1,y=!1;this.getGroup=function(){return f},this.setVisibility=function(e){f.visible=e},this.load=function(e,p,f){t=e.axis1,i=e.axis2,o=e.axis3,r=e.positions,a=e.scale,s=e.colors,g=e.metadata.MorphColours,y=e.metadata.MorphVertices,c=e.metadata.number_of_time_steps,h=e.metadata.repeat_mode,u=e.metadata.number_of_vertices,"AXES_2D"==h||"MIRROR"==h?u*=2:"AXES_3D"==h&&(u*=3),l=e.metadata.base_size,d=e.metadata.offset,m=e.metadata.scale_factors,new n.JSONLoader(!0).load(p,w(f))};var b=function(e,t,i,n,o){var r=[];if("NONE"==h||"MIRROR"==h){for(var a=[0,0,0],s=[0,0,0],c=[0,0,0],u=[0,0,0],p=[0,0,0],f=[0,0,0],v=[0,0,0],g=[0,0,0],y=[0,0,0],b=0;b<3;b++){var x=o[b]<0?-1:1;a[b]=x*l[b]+o[b]*m[b]}for(b=0;b<3;b++)s[b]=t[b]*a[0],c[b]=i[b]*a[1],u[b]=n[b]*a[2],p[b]=e[b]+d[0]*s[b]+d[1]*c[b]+d[2]*u[b],"MIRROR"==h&&(f[b]=-s[b],v[b]=-c[b],g[b]=-u[b],y[b]=p[b],o[0]<0&&(p[b]-=s[b],y[b]-=f[b]));0>u[0]*(s[1]*c[2]-s[2]*c[1])+u[1]*(s[2]*c[0]-s[0]*c[2])+u[2]*(s[0]*c[1]-s[1]*c[0])&&(u[0]=-u[0],u[1]=-u[1],u[2]=-u[2]),r.push([p,s,c,u]),"MIRROR"==h&&(0>g[0]*(f[1]*v[2]-f[2]*v[1])+g[1]*(f[2]*v[0]-f[0]*v[2])+g[2]*(f[0]*v[1]-f[1]*v[0])&&(g[0]=-g[0],g[1]=-g[1],g[2]=-g[2]),r.push([y,f,v,g]))}else if("AXES_2D"==h||"AXES_3D"==h){for(a=[0,0,0],p=[0,0,0],b=0;b<3;b++){x=o[b]<0?-1:1;a[b]=x*l[0]+o[b]*m[0]}for(b=0;b<3;b++)p[b]=e[b]+d[0]*a[0]*t[b]+d[1]*a[1]*i[b]+d[2]*a[2]*n[b];for(var O="AXES_2D"==glyph_repeat_mode?2:3,_=0;_<O;_++){var w,C,j=o[_];s=[0,0,0],c=[0,0,0],u=[0,0,0];0==_?(w=t,C=i):1==_?(w=i,C="AXES_2D"==glyph_repeat_mode?t:n):(w=n,C=t);var E=l[0]+j*m[0];s[0]=w[0]*E,s[1]=w[1]*E,s[2]=w[2]*E,u[0]=s[1]*C[2]-C[1]*s[2],u[1]=s[2]*C[0]-C[2]*s[0],u[2]=s[0]*C[1]-s[1]*C[0];var R=Math.sqrt(u[0]*u[0]+u[1]*u[1]+u[2]*u[2]);if(0<R){var M=(l[2]+j*m[2])/R;"AXES_2D"==h&&_>0&&(M*=-1),u[0]*=M,u[1]*=M,u[2]*=M}if(c[0]=u[1]*s[2]-s[1]*u[2],c[1]=u[2]*s[0]-s[2]*u[0],c[2]=u[0]*s[1]-u[1]*s[0],0<(R=Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]))){M=(l[1]+j*m[1])/R;c[0]*=M,c[1]*=M,c[2]*=M}r.push([p,s,c,u])}}return r},x=function(t,i,n,o,r){var a=1;"AXES_2D"==h||"MIRROR"==h?a=2:"AXES_3D"==h&&(a=3);for(var s=t.length/3,c=0,u=0;u<s;u++){var l=3*u,d=[t[l],t[l+1],t[l+2]],m=[i[l],i[l+1],i[l+2]],p=[n[l],n[l+1],n[l+2]],f=[o[l],o[l+1],o[l+2]],v=[r[l],r[l+1],r[l+2]],g=b(d,m,p,f,v);if(g.length==a)for(var y=0;y<a;y++){var x=e[c];x&&x.setTransformation(g[y][0],g[y][1],g[y][2],g[y][3]),c++}}},O=function(t){var i=1;"AXES_2D"==h||"MIRROR"==h?i=2:"AXES_3D"==h&&(i=3);for(var o=t.length,r=0,a=0;a<o;a++)for(var s=t[a],c=0;c<i;c++){var u=e[r];if(u){var l=new n.Color(s);u.setColor(l)}r++}},_=function(){var e=[],u=[],l=[],d=[],m=[],h=[],f=p/v.duration*(c-1),b=Math.floor(f),_=1-(f-b),w=Math.ceil(f);if(y)for(var C=r[b.toString()],j=r[w.toString()],E=t[b.toString()],R=t[w.toString()],M=i[b.toString()],S=i[w.toString()],T=o[b.toString()],L=o[w.toString()],P=a[b.toString()],z=a[w.toString()],A=0;A<C.length;A++)e.push(_*C[A]+(1-_)*j[A]),u.push(_*E[A]+(1-_)*R[A]),l.push(_*M[A]+(1-_)*S[A]),d.push(_*T[A]+(1-_)*L[A]),m.push(_*P[A]+(1-_)*z[A]);else e=r[0],u=t[0],l=i[0],d=o[0],m=a[0];if(x(e,u,l,d,m),void 0!=s){if(g){var V=s[b.toString()],G=s[w.toString()];for(A=0;A<V.length;A++){var D=new n.Color(V[A]),N=new n.Color(G[A]),B=new n.Color(D.r*_+N.r*(1-_),D.g*_+N.g*(1-_),D.b*_+N.b*(1-_));h.push(B.getHex())}}else h=s[0];O(h)}e=null,u=null,l=null,d=null,m=null,h=null};this.forEachGlyph=function(t){for(var i=0;i<e.length;i++)t(e[i])};var w=function(n){return function(c,l){var d=void 0;l&&l[0]&&(d=l[0]),function(n,c){for(var l=0;l<u;l++){var d=new Zinc.Glyph(n,c,l+1);e[l]=d,f.add(d.getMesh())}x(r[0],t[0],i[0],o[0],a[0]),void 0!=s&&O(s[0]),v.ready=!0}(c,d),void 0!=n&&"function"==typeof n&&n(v)}};this.getBoundingBox=function(){for(var t=void 0,i=void 0,n=0;n<e.length;n++)i=e[n].getBoundingBox(),void 0==t?t=i:t.union(i);return t},this.setMorphTime=function(e){p=e>v.duration?v.duration:0>e?0:e,(g||y)&&_()},this.dispose=function(){for(var n=e.length-1;n>=0;n--)e[n].dispose();t=void 0,i=void 0,o=void 0,r=void 0,a=void 0,s=void 0,v.ready=!1,void 0},this.render=function(e,t){if(1==t){var i=p+e;i>v.duration&&(i-=v.duration),p=i,(g||y)&&_()}}}},function(e,t,n){var o=n(1);t.Renderer=function(e,t){var n=e,r=void 0,a=void 0,s=new o.Clock;this.playAnimation=!0;var c=500,u={},l=0,d=void 0,m=void 0,h=void 0,p=void 0,f=[],v=[],g=new o.Group,y=this,b=[0,0],x=[0,0];this.onWindowResize=function(){if(a.onWindowResize(),void 0!=r){r.setSize(n.clientWidth,n.clientHeight),b[0]=r.getSize().width,b[1]=r.getSize().height;var e=n.getBoundingClientRect();x[0]=e.left,x[1]=e.top}},this.initialiseVisualisation=function(){var e=!1;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(e=!0),r=e?new o.WebGLRenderer({antialias:!1}):new o.WebGLRenderer({antialias:!0}),n.appendChild(r.domElement),r.setClearColor(16777215,1);var t=y.createScene("default");y.setCurrentScene(t)},this.getCurrentScene=function(){return a},this.setCurrentScene=function(e){if(e){y.removeActiveScene(e);var t=a;a=e,t&&t.setInteractiveControlEnable(!1),a.setInteractiveControlEnable(!0),a.setAdditionalScenesGroup(g),y.onWindowResize()}},this.getSceneByName=function(e){return f[e]},this.createScene=function(e){if(void 0==f[e]){var t=new Zinc.Scene(n,r);return f[e]=t,t.sceneName=e,t}};this.resetView=function(){a.resetView()},this.viewAll=function(){if(a){var e=a.getBoundingBox();if(e){for(i=0;i<v.length;i++){var t=v[i].getBoundingBox();t&&e.union(t)}a.viewAllWithBoundingBox(e)}}},this.loadModelsURL=function(e,t,i,n,o,r){a.loadModelsURL(e,t,i,n,o,r)};this.loadViewURL=function(e){a.loadViewURL(e)},this.loadFromViewURL=function(e,t){a.loadFromViewURL(e,t)},this.addZincGeometry=function(e,t,i,n,o,r,s,c){return a.addZincGeometry(e,t,i,n,o,r,s,c)},this.updateDirectionalLight=function(){a.updateDirectionalLight()},this.stopAnimate=function(){cancelAnimationFrame(d),d=void 0},this.animate=function(){d=requestAnimationFrame(y.animate),y.render()};Date.now();this.addPreRenderCallbackFunction=function(e){return u[l+=1]=e,l},this.removePreRenderCallbackFunction=function(e){e in u&&delete u[e]},this.getPlayRate=function(){return c},this.setPlayRate=function(e){c=e},this.getCurrentTime=function(){return a.getCurrentTime()},this.setMorphsTime=function(e){a.setMorphsTime(e)},this.getZincGeometryByID=function(e){return a.getZincGeometryByID(e)},this.addToScene=function(e){a.addObject(e)},this.addToOrthoScene=function(e){void 0==h&&(h=new o.Scene),void 0==m&&((m=new o.OrthographicCamera(-n.clientWidth/2,n.clientWidth/2,n.clientHeight/2,-n.clientHeight/2,1,10)).position.z=10),h.add(e)};this.addLogo=function(){p=new o.Sprite;o.ImageUtils.loadTexture("images/abi_big_logo_transparent_small.png",void 0,function(e){return function(t){t.needsUpdate=!0;var i=new o.SpriteMaterial({map:t}),r=i.map.image.width,a=i.map.image.height;e.material=i,e.scale.set(r,a,1),e.position.set((n.clientWidth-r)/2,(-n.clientHeight+a)/2,1),y.addToOrthoScene(e)}}(p))},this.render=function(){var e=n.getBoundingClientRect();b[0]==n.clientWidth&&b[1]==n.clientHeight&&e.left==x[0]&&e.top==x[1]||y.onWindowResize();var t=s.getDelta();for(a.renderGeometries(c,t,y.playAnimation),i=0;i<v.length;i++){v[i].renderGeometries(c,t,y.playAnimation)}for(key in void 0!=m&&void 0!=h&&(r.clearDepth(),r.render(h,m)),u)u.hasOwnProperty(key)&&u[key].call();a.render(r)},this.getThreeJSRenderer=function(){return r},this.isSceneActive=function(e){if(a===e)return!0;for(i=0;i<v.length;i++){if(v[i]===e)return!0}return!1},this.addActiveScene=function(e){y.isSceneActive(e)||(v.push(e),g.add(e.getThreeJSScene()))},this.removeActiveScene=function(e){for(i=0;i<v.length;i++){if(v[i]===e)return v.splice(i,1),void g.remove(e.getThreeJSScene())}},this.clearAllActiveScene=function(){for(var e=0;e<v.length;e++)g.remove(v[e].getThreeJSScene());v.splice(0,v.length)},this.transitionScene=function(e,t){if(a){var i=a.getZincCameraControls(),n=e.getBoundingBox();if(n){var o=n.min.distanceTo(n.max)/2,r=(n.min.x+n.max.x)/2,s=(n.min.y+n.max.y)/2,c=(n.min.z+n.max.z)/2,u=i.getViewportFromCentreAndRadius(r,s,c,o,40,4*o),l=i.getCurrentViewport();i.cameraTransition(l,u,t),i.enableCameraTransition()}}}}},function(e,t,n){var o=n(1);t.Scene=function(e,t){var n=e,r=[],a=[],s=new o.Scene;this.directionalLight=void 0,this.ambient=void 0,this.camera=void 0;var c=3e3,u=void 0,l=0,d=1e3;this.sceneName=void 0,this.progressMap=[];var m=!1,h=!1,p=void 0,f=this;this.autoClearFlag=!0,this.getDownloadProgress=function(){var e=0,t=0,i=!1;for(var n in f.progressMap){var o=f.progressMap[n];e+=o[1],t+=o[0],0==o[1]&&(i=!0)}return i&&(e=0),[e,t,m]},this.onProgress=function(e){return function(t){f.progressMap[e]=[t.loaded,t.total]}},this.onError=function(e){m=!0},this.onWindowResize=function(){u.onResize(),f.camera.aspect=n.clientWidth/n.clientHeight,f.camera.updateProjectionMatrix()},this.resetView=function(){f.onWindowResize(),u.resetView()};f.camera=new o.PerspectiveCamera(40,n.clientWidth/n.clientHeight,0,10),f.ambient=new o.AmbientLight(2105376),s.add(f.ambient),f.directionalLight=new o.DirectionalLight(7829367),s.add(f.directionalLight),(u=new Zinc.CameraControls(f.camera,t.domElement,t,s)).setDirectionalLight(f.directionalLight),u.resetView();var v=function(){for(var e=!0;1==e;){d++,e=!1;for(var t=0;t<r.length;t++)r[t].modelId==d&&(e=!0)}return d};this.loadView=function(e){var t=new Zinc.Viewport;t.nearPlane=e.nearPlane,t.farPlane=e.farPlane,t.eyePosition=e.eyePosition,t.targetPosition=e.targetPosition,t.upVector=e.upVector,u.setDefaultCameraSettings(t),u.resetView()},this.getBoundingBox=function(){for(var e=void 0,t=void 0,i=0;i<r.length;i++)t=r[i].getBoundingBox(),void 0==e?e=t:e.union(t);for(i=0;i<a.length;i++)t=a[i].getBoundingBox(),void 0==e?e=t:e.union(t);return e},this.viewAllWithBoundingBox=function(e){if(e){var t=e.min.distanceTo(e.max)/2,i=(e.min.x+e.max.x)/2,n=(e.min.y+e.max.y)/2,o=(e.min.z+e.max.z)/2,r=u.getViewportFromCentreAndRadius(i,n,o,t,40,4*t);u.setCurrentCameraSettings(r)}},this.viewAll=function(){var e=f.getBoundingBox();f.viewAllWithBoundingBox(e)},this.forEachGeometry=function(e){for(var t=0;t<r.length;t++)e(r[t])},this.forEachGlyphset=function(e){for(var t=0;t<a.length;t++)e(a[t])},this.findGeometriesWithGroupName=function(e){for(var t=[],i=0;i<r.length;i++)r[i].groupName==e&&t.push(r[i]);return t},this.findGlyphsetsWithGroupName=function(e){for(var t=[],i=0;i<a.length;i++)a[i].groupName==e&&t.push(a[i]);return t};var g=function(e,t,i,n){return function(){4==e.readyState&&200==e.status&&function(e,t,i,n){var o=new Zinc.Glyphset;o.duration=3e3,o.load(e,t,n),o.groupName=i;var r=o.getGroup();s.add(r),a.push(o)}(JSON.parse(e.responseText),t,i,n)}};this.loadGlyphsetURL=function(e,t,i,n){var o=new XMLHttpRequest;o.onreadystatechange=g(o,t,i,n),o.open("GET",e,!0),o.send()};var y=function(e,t){e&&("Surfaces"==e.Type?function(e,t,n,r,a,s){l+=1;var c=v(),u=Zinc.defaultMaterialColor,d=Zinc.defaultOpacity,m=0;void 0!=t&&(m=!!t);var h=0;void 0!=n&&(h=!!n);var p=new o.JSONLoader(!0);if(void 0!==a)if("STL"==a)p=new o.STLLoader;else if("OBJ"==a)return void(p=new o.OBJLoader).load(e,x(c,u,d,m,h,r,s),f.onProgress(i),f.onError);p.load(e,O(c,u,d,m,h,r,s),f.onProgress(i),f.onError)}(e.URL,e.MorphVertices,e.MorphColours,e.GroupName,e.FileFormat,t):"Glyph"==e.Type&&f.loadGlyphsetURL(e.URL,e.GlyphGeometriesURL,e.GroupName,t))};this.loadSTL=function(e,t,i){l+=1;var n=v(),r=Zinc.defaultMaterialColor,a=Zinc.defaultOpacity;(new o.STLLoader).load(e,O(n,r,a,!1,!1,t,i))},this.loadOBJ=function(e,t,i){l+=1;var n=v(),r=Zinc.defaultMaterialColor,a=Zinc.defaultOpacity;(new o.OBJLoader).load(e,O(n,r,a,!1,!1,t,i))},this.loadMetadataURL=function(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){var e=JSON.parse(n.responseText),o=e.length;for(i=0;i<o;i++)y(e[i],t)}},requestURL=e,n.open("GET",e,!0),n.send()},this.loadModelsURL=function(e,t,i,n,r,a){var s=e.length;l+=s;for(var c=0;c<s;c++){var u=v(),d=e[c],m=new o.JSONLoader(!0),h=Zinc.defaultMaterialColor,p=Zinc.defaultOpacity;void 0!=t&&void 0!=t[c]&&(h=!!t[c]),void 0!=i&&void 0!=i[c]&&(p=i[c]);var g=0;void 0!=n&&void 0!=n[c]&&(g=!!n[c]);var y=0;void 0!=r&&void 0!=r[c]&&(y=!!r[c]),m.load(d,O(u,h,p,g,y,void 0,a),f.onProgress(c),f.onError)}},this.loadViewURL=function(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){var e=JSON.parse(t.responseText);f.loadView(e)}},requestURL=e,t.open("GET",requestURL,!0),t.send()},this.loadFromViewURL=function(e,t){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==i.readyState&&200==i.status){var n=JSON.parse(i.responseText);f.loadView(n);for(var o=[],r=e+"_",a=0;a<n.numberOfResources;a++){var s=r+(a+1)+".json";o.push(s)}f.loadModelsURL(o,n.colour,n.opacity,n.timeEnabled,n.morphColour,t)}},requestURL=e+"_view.json",i.open("GET",requestURL,!0),i.send()};var b=function(e,t,i,n){var a=new Zinc.Geometry;s.add(e);var u=new o.AnimationMixer(e),l=void 0,d=e.geometry;if(d.morphTargets){var m=o.AnimationClip.CreateClipsFromMorphTargetSequences(d.morphTargets,10,!0);if(m&&void 0!=m[0])(l=u.clipAction(m[0]).setDuration(c)).loop=o.loopOnce,l.clampWhenFinished=!0,l.play()}return a.duration=3e3,a.geometry=d,a.timeEnabled=i,a.morphColour=n,a.modelId=t,a.morph=e,a.mixer=u,a.clipAction=l,r.push(a),a},x=function(e,t,i,n,r,a,s){return function(t){l++,t.traverse(function(t){if(t instanceof o.Mesh){var i=b(t,e,n,r);i.morph&&(i.morph.name=a),i.groupName=a,void 0!=s&&"function"==typeof s&&s(i)}})}};this.addZincGeometry=function(e,t,i,n,r,a,s,c,u){void 0==s&&(s=!0),s&&l++,isTransparent=!1,1>n&&(isTransparent=!0);var d=void 0;u?(d=u).morphTargets=r:d=e instanceof o.BufferGeometry&&void 0===e.attributes.color?new o.MeshPhongMaterial({color:i,morphTargets:r,morphNormals:!1,transparent:isTransparent,opacity:n}):new o.MeshPhongMaterial({color:i,morphTargets:r,morphNormals:!1,vertexColors:o.VertexColors,transparent:isTransparent,opacity:n}),e instanceof o.Geometry&&e.computeMorphNormals(),d.side=o.DoubleSide;var m;m=new o.Mesh(e,d);var h=b(m,t,r,a);return void 0!=c&&"function"==typeof c&&c(h),h};var O=function(e,t,i,n,o,r,a){return function(s,c){var u=void 0;c&&c[0]&&(u=c[0]);var l=f.addZincGeometry(s,e,t,i,n,o,!1,void 0,u);l.morph&&(l.morph.name=r),l.groupName=r,void 0!=a&&"function"==typeof a&&a(l)}};this.updateDirectionalLight=function(){u.updateDirectionalLight()},this.addObject=function(e){s.add(e)},this.getCurrentTime=function(){var e=0;if(void 0!=r[0]){r[0].mixer;e=r[0].getCurrentTime()}return e},this.setMorphsTime=function(e){for(var t=0;t<r.length;t++)zincGeometry=r[t],zincGeometry.setMorphTime(e);for(t=0;t<a.length;t++)zincGlyphset=a[t],zincGlyphset.setMorphTime(e)},this.getZincGeometryByID=function(e){for(var t=0;t<r.length;t++)if(r[t].modelId==e)return r[t];return null};this.renderGeometries=function(e,t,i){if(u.update(t),r.length==l&&function(){for(var e=0;e<a.length;e++)if(zincGlyphset=a[e],0==zincGlyphset.ready)return!1;return!0}()){for(var n=0;n<r.length;n++)r[n].render(e*t,i);for(n=0;n<a.length;n++)a[n].render(e*t,i)}},this.getThreeJSScene=function(){return s},this.setAdditionalScenesGroup=function(e){s.add(e)},this.render=function(e){f.autoClearFlag&&e.clear(),h&&p?p.render(s,f.camera):e.render(s,f.camera)},this.setInteractiveControlEnable=function(e){1==e?u.enable():u.disable()},this.getZincCameraControls=function(){return u},this.getThreeJSScene=function(){return s},this.setDuration=function(e){c=e},this.getDuration=function(){return c},this.setStereoEffectEnable=function(e){1==e?(p||(p=new o.StereoEffect(t)),p.setSize(n.clientWidth,n.clientHeight)):t.setSize(n.clientWidth,n.clientHeight),f.camera.updateProjectionMatrix(),h=e},this.isStereoEffectEnable=function(){return h},this.removeZincGeometry=function(e){for(var t=0;t<r.length;t++)if(e===r[t])return s.remove(e.morph),r.splice(t,1),void e.dispose()},this.removeZincGlyphset=function(e){for(var t=0;t<a.length;t++)if(e===a[t])return s.remove(e.getGroup()),a[t].dispose(),void a.splice(t,1)},this.clearAll=function(){for(var e=r.length-1;e>=0;e--)s.remove(r[e].morph),r[e].dispose();r=[];for(e=a.length-1;e>=0;e--)s.remove(a[e].getGroup()),a[e].dispose();a=[]}}},function(e,t,i){var n,o,r,a,s,c,u,l,d=i(1);t.Viewport=function(){this.nearPlane=.1,this.farPlane=2e3,this.eyePosition=[0,0,0],this.targetPosition=[0,0,0],this.upVector=[0,1,0]},t.CameraControls=function(e,t,i,n){var o=this,r=0,a=1,s=2,c=3,u={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5,SCROLL:6},l={};l.MAIN=u.ROTATE,l.AUXILIARY=u.PAN,l.SECONDARY=u.ZOOM,this.cameraObject=e,this.domElement=void 0!==t?t:document,this.renderer=i,this.scene=n,this.tumble_rate=1.5,this.pointer_x=0,this.pointer_y=0,this.pointer_x_start=0,this.pointer_y_start=0,this.previous_pointer_x=0,this.previous_pointer_y=0,this.near_plane_fly_debt=0,this.touchZoomDistanceStart=0,this.touchZoomDistanceEnd=0,this.directionalLight=0,this.scrollRate=50;var m=3e3,h=0,p=void 0,f=void 0,v=!1,g=500,y=void 0,b=new Zinc.Viewport,x=r,O=void 0,_=void 0,w=0;this._state=u.NONE;var C=void 0;this.targetTouchId=-1;var j=void 0;function E(e){void 0===j&&(j=o.domElement.getBoundingClientRect()),0==e.button?o._state=l.MAIN:1==e.button?(e.preventDefault(),o._state=l.AUXILIARY):2==e.button&&(o._state=l.SECONDARY),o.pointer_x=e.clientX-j.left,o.pointer_y=e.clientY-j.top,o.pointer_x_start=o.pointer_x,o.pointer_y_start=o.pointer_y,o.previous_pointer_x=o.pointer_x,o.previous_pointer_y=o.pointer_y}function R(e){void 0===j&&(j=o.domElement.getBoundingClientRect()),o.pointer_x=e.clientX-j.left,o.pointer_y=e.clientY-j.top,void 0!==C&&C.move(o,e.clientX,e.clientY,o.renderer)}function M(e){o._state=u.NONE,void 0!==C&&o.pointer_x_start==e.clientX-j.left&&o.pointer_y_start==e.clientY-j.top&&C.pick(o,e.clientX,e.clientY,o.renderer)}function S(e){o._state=u.NONE}function T(e){void 0===j&&(j=o.domElement.getBoundingClientRect());var t=e.touches.length;if(1==t)o._state=u.TOUCH_ROTATE,o.pointer_x=e.touches[0].clientX-j.left,o.pointer_y=e.touches[0].clientY-j.top,o.pointer_x_start=o.pointer_x,o.pointer_y_start=o.pointer_y,o.previous_pointer_x=o.pointer_x,o.previous_pointer_y=o.pointer_y;else if(2==t){o._state=u.TOUCH_ZOOM;var i=e.touches[0].clientX-e.touches[1].clientX,n=e.touches[0].clientY-e.touches[1].clientY;o.touchZoomDistanceEnd=o.touchZoomDistanceStart=Math.sqrt(i*i+n*n)}else 3==t&&(o._state=u.TOUCH_PAN,o.targetTouchId=e.touches[0].identifier,o.pointer_x=e.touches[0].clientX-j.left,o.pointer_y=e.touches[0].clientY-j.top,o.previous_pointer_x=o.pointer_x,o.previous_pointer_y=o.pointer_y)}function L(e){e.preventDefault(),e.stopPropagation();var t=e.touches.length;if(1==t)o.pointer_x=e.touches[0].clientX-j.left,o.pointer_y=e.touches[0].clientY-j.top;else if(2==t){if(o._state===u.TOUCH_ZOOM){var i=e.touches[0].clientX-e.touches[1].clientX,n=e.touches[0].clientY-e.touches[1].clientY;o.touchZoomDistanceEnd=Math.sqrt(i*i+n*n)}}else if(3==t&&o._state===u.TOUCH_PAN)for(var r=0;r<3;r++)e.touches[r].identifier==o.targetTouchId&&(o.pointer_x=e.touches[0].clientX-j.left,o.pointer_y=e.touches[0].clientY-j.top)}function P(e){var t=e.touches.length;o.touchZoomDistanceStart=o.touchZoomDistanceEnd=0,o.targetTouchId=-1,o._state=u.NONE,1==t&&void 0!==C&&o.pointer_x_start==e.touches[0].clientX-j.left&&o.pointer_y_start==e.touches[0].clientY-j.top&&C.pick(o.cameraObject,e.touches[0].clientX,e.touches[0].clientY,o.renderer)}function z(e){void 0===j&&(j=o.domElement.getBoundingClientRect()),o._state=u.SCROLL;var t=0;e.deltaY>0?t=o.scrollRate:e.deltaY<0&&(t=-1*o.scrollRate),w+=t,e.preventDefault(),e.stopImmediatePropagation()}function A(){if(void 0!==o.cameraObject){j.width;var e=j.height,t=o.cameraObject.position.clone();t.sub(o.cameraObject.target);var i=(c=0,o._state===u.ZOOM?c=o.previous_pointer_y-o.pointer_y:o._state===u.SCROLL?c=w:(c=-1*(o.touchZoomDistanceEnd-o.touchZoomDistanceStart),o.touchZoomDistanceStart=o.touchZoomDistanceEnd),c),n=t.length(),r=1.5*i/e;if(n+r*n>.01){t.normalize();var a=o.cameraObject.position.clone();a.x=a.x+t.x*r*n,a.y=a.y+t.y*r*n,a.z=a.z+t.z*r*n,o.cameraObject.position.set(a.x,a.y,a.z),o.updateDirectionalLight();if(1e-5*o.cameraObject.far<o.cameraObject.near+r*n+o.near_plane_fly_debt)0!=o.near_plane_fly_debt&&(o.near_plane_fly_debt+=r*n,o.near_plane_fly_debt>0?(o.cameraObject.near+=o.near_plane_fly_debt,o.cameraObject.far+=o.near_plane_fly_debt,o.near_plane_fly_debt=0):(o.cameraObject.near+=r*n,o.cameraObject.far+=r*n));else{if(0==o.near_plane_fly_debt){var s=o.cameraObject.near-1e-5*o.cameraObject.far;o.cameraObject.near=1e-5*o.cameraObject.far,o.cameraObject.far-=s,o.near_plane_fly_debt-=1e-5*o.cameraObject.far}o.near_plane_fly_debt+=r*n}}}var c;o._state===u.ZOOM&&(o.previous_pointer_x=o.pointer_x,o.previous_pointer_y=o.pointer_y),o._state===u.SCROLL&&(w=0)}void 0===o.cameraObject.target&&(o.cameraObject.target=new d.Vector3(0,0,0)),this.onResize=function(){j&&(j=void 0)},this.setMouseButtonAction=function(e,t){l[e]=u[t]},this.rotateAboutLookAtpoint=function(e,t){e.normalize();var i=o.cameraObject.position.clone();i.sub(o.cameraObject.target);var n=i.clone();i.normalize(),.8<Math.abs(i.x*e.x+i.y*e.y+i.z*e.z)&&(i=o.cameraObject.up.clone());var r=new d.Vector3(e.y*i.z-e.z*i.y,e.z*i.x-e.x*i.z,e.x*i.y-e.y*i.x);r.normalize();var a=new d.Vector3(e.y*r.z-e.z*r.y,e.z*r.x-e.x*r.z,e.x*r.y-e.y*r.x),s=e.x*n.x+e.y*n.y+e.z*n.z,c=r.x*n.x+r.y*n.y+r.z*n.z,u=a.x*n.x+a.y*n.y+a.z*n.z,l=e.x*o.cameraObject.up.x+e.y*o.cameraObject.up.y+e.z*o.cameraObject.up.z,m=r.x*o.cameraObject.up.x+r.y*o.cameraObject.up.y+r.z*o.cameraObject.up.z,h=a.x*o.cameraObject.up.x+a.y*o.cameraObject.up.y+a.z*o.cameraObject.up.z,p=Math.cos(t),f=Math.sin(t),v=new d.Vector3(p*r.x+f*a.x,p*r.y+f*a.y,p*r.z+f*a.z),g=new d.Vector3(p*a.x-f*r.x,p*a.y-f*r.y,p*a.z-f*r.z),y=o.cameraObject.target.clone();y.x=y.x+e.x*s+v.x*c+g.x*u,y.y=y.y+e.y*s+v.y*c+g.y*u,y.z=y.z+e.z*s+v.z*c+g.z*u,o.cameraObject.position.set(y.x,y.y,y.z),o.updateDirectionalLight(),o.cameraObject.up.set(e.x*l+v.x*m+g.x*h,e.y*l+v.y*m+g.y*h,e.z*l+v.z*m+g.z*h)},this.setDirectionalLight=function(e){o.directionalLight=e},this.updateDirectionalLight=function(){0!=o.directionalLight&&o.directionalLight.position.set(o.cameraObject.position.x,o.cameraObject.position.y,o.cameraObject.position.z)},this.enable=function(){enabled=!0,this.domElement.addEventListener&&(this.domElement.addEventListener("mousedown",E,!1),this.domElement.addEventListener("mousemove",R,!1),this.domElement.addEventListener("mouseup",M,!1),this.domElement.addEventListener("mouseleave",S,!1),this.domElement.addEventListener("touchstart",T,!1),this.domElement.addEventListener("touchmove",L,!1),this.domElement.addEventListener("touchend",P,!1),this.domElement.addEventListener("wheel",z,!1),this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1))},this.disable=function(){enabled=!1,this.domElement.removeEventListener&&(this.domElement.removeEventListener("mousedown",E,!1),this.domElement.removeEventListener("mousemove",R,!1),this.domElement.removeEventListener("mouseup",M,!1),this.domElement.removeEventListener("mouseleave",S,!1),this.domElement.removeEventListener("touchstart",T,!1),this.domElement.removeEventListener("touchmove",L,!1),this.domElement.removeEventListener("touchend",P,!1),this.domElement.removeEventListener("wheel",z,!1),this.domElement.removeEventListener("contextmenu",function(e){e.preventDefault()},!1))};this.loadPathURL=function(e,t){var i=new XMLHttpRequest;i.onreadystatechange=function(){4==i.readyState&&200==i.status&&function(e){p=e.CameraPath,f=e.NumberOfPoints}(JSON.parse(i.responseText))},requestURL=e,i.open("GET",requestURL,!0),i.send()},this.setPathDuration=function(e){m=e},this.setTime=function(e){h=e},this.setPlayRate=function(e){g=e};this.getNumberOfTimeFrame=function(){return f},this.getCurrentTimeFrame=function(){var e=h/m*(f-1),t=Math.floor(e),i=1-(e-t);return[t,Math.ceil(e),i]},this.setCurrentTimeFrame=function(e){(h=m*e/(f-1))<0&&(h=0),h>m&&(h=m)};var V=function(e){if(x===a&&(function(e){var t=h+e;t>m&&(t-=m),h=t}(e),p)){for(var t=o.getCurrentTimeFrame(),i=t[0],n=t[1],r=t[2],s=[p[3*i],p[3*i+1],p[3*i+2]],c=[p[3*n],p[3*n+1],p[3*n+2]],u=[],l=0;l<s.length;l++)u.push(r*s[l]+(1-r)*c[l]);o.cameraObject.position.set(u[0],u[1],u[2]),o.cameraObject.target.set(c[0],c[1],c[2]),v&&(o.directionalLight.position.set(u[0],u[1],u[2]),o.directionalLight.target.position.set(c[0],c[1],c[2]))}};this.update=function(e){var t=e*g,i=enabled;x===a?V(t):x===s&&O?(O.update(t),O.isTransitionCompleted()&&(x=r),i=!1):x===c&&_&&_.update(t),i&&(o._state===u.ROTATE||o._state===u.TOUCH_ROTATE?function(){if(void 0!==o.cameraObject){var e=j.width,t=j.height;if(0<e&&0<t){var i=.25*(e+t);delta_x=o.pointer_x-o.previous_pointer_x,delta_y=o.previous_pointer_y-o.pointer_y;var n=Math.sqrt(delta_x*delta_x+delta_y*delta_y);if(n>0){var r=1*-delta_y/n,a=1*delta_x/n,s=r*(o.pointer_x-.5*(e-1))+a*(.5*(t-1)-o.pointer_y);s>i?s=i:s<-i&&(s=-i);var c=Math.acos(s/i)-.5*Math.PI,u=o.tumble_rate*n/i,l=o.cameraObject.position.clone();l.sub(o.cameraObject.target),l.normalize();var m=o.cameraObject.up.clone();m.normalize();var h=m.clone();h.cross(l),h.normalize();var p=[r*h.x+a*m.x,r*h.y+a*m.y,r*h.z+a*m.z],f=new d.Vector3;f.set(Math.sin(c)*l.x+Math.cos(c)*p[0],Math.sin(c)*l.y+Math.cos(c)*p[1],Math.sin(c)*l.z+Math.cos(c)*p[2]),o.rotateAboutLookAtpoint(f,-u)}}}o.previous_pointer_x=o.pointer_x,o.previous_pointer_y=o.pointer_y}():o._state===u.PAN||o._state===u.TOUCH_PAN?function(){if(void 0!==o.cameraObject){j.width;var e=j.height,t=o.cameraObject.position.distanceTo(o.cameraObject.target),i=0;o.cameraObject.far>o.cameraObject.near&&t>=o.cameraObject.near&&t<=o.cameraObject.far&&(i=(t-o.cameraObject.near)/(o.cameraObject.far-o.cameraObject.near));var n=new d.Vector3(o.previous_pointer_x,e-o.previous_pointer_y,0),r=new d.Vector3(o.previous_pointer_x,e-o.previous_pointer_y,1),a=new d.Vector3(o.pointer_x,e-o.pointer_y,0),s=new d.Vector3(o.pointer_x,e-o.pointer_y,1);n.unproject(o.cameraObject),r.unproject(o.cameraObject),a.unproject(o.cameraObject),s.unproject(o.cameraObject);var c=.002*((1-i)*(a.x-n.x)+i*(s.x-r.x)),u=.002*((1-i)*(a.y-n.y)+i*(s.y-r.y)),l=.002*((1-i)*(a.z-n.z)+i*(s.z-r.z));o.cameraObject.position.set(o.cameraObject.position.x-c,o.cameraObject.position.y-u,o.cameraObject.position.z-l),o.updateDirectionalLight(),o.cameraObject.target.set(o.cameraObject.target.x-c,o.cameraObject.target.y-u,o.cameraObject.target.z-l)}o.previous_pointer_x=o.pointer_x,o.previous_pointer_y=o.pointer_y}():o._state!==u.ZOOM&&o._state!==u.TOUCH_ZOOM&&o._state!==u.SCROLL||A(),o._state!==u.NONE&&x===c&&_&&_.stopOnCameraInput,o._state===u.SCROLL&&(o._state=u.NONE)),y?y.update():o.cameraObject.lookAt(o.cameraObject.target)},this.playPath=function(){x=a},this.stopPath=function(){x=r},this.isPlayingPath=function(){return x===a},this.enableDirectionalLightUpdateWithPath=function(e){v=e},this.enableDeviceOrientation=function(){y||(y=new ModifiedDeviceOrientationControls(o.cameraObject))},this.disableDeviceOrientation=function(){y&&(y.dispose(),y=void 0)},this.isDeviceOrientationEnabled=function(){return!!y},this.resetView=function(){o.cameraObject.near=b.nearPlane,o.cameraObject.far=b.farPlane,o.cameraObject.position.set(b.eyePosition[0],b.eyePosition[1],b.eyePosition[2]),o.cameraObject.target.set(b.targetPosition[0],b.targetPosition[1],b.targetPosition[2]),o.cameraObject.up.set(b.upVector[0],b.upVector[1],b.upVector[2]),o.cameraObject.updateProjectionMatrix(),o.updateDirectionalLight()},this.setDefaultCameraSettings=function(e){e.nearPlane&&(b.nearPlane=e.nearPlane),e.farPlane&&(b.farPlane=e.farPlane),e.eyePosition&&(b.eyePosition=e.eyePosition),e.targetPosition&&(b.targetPosition=e.targetPosition),e.upVector&&(b.upVector=e.upVector)},this.setCurrentCameraSettings=function(e){e.nearPlane&&(o.cameraObject.near=e.nearPlane),e.farPlane&&(o.cameraObject.far=e.farPlane),e.eyePosition&&o.cameraObject.position.set(e.eyePosition[0],e.eyePosition[1],e.eyePosition[2]),e.targetPosition&&o.cameraObject.target.set(e.targetPosition[0],e.targetPosition[1],e.targetPosition[2]),e.upVector&&o.cameraObject.up.set(e.upVector[0],e.upVector[1],e.upVector[2]),o.cameraObject.updateProjectionMatrix(),o.updateDirectionalLight()},this.getViewportFromCentreAndRadius=function(e,t,i,n,r,a){var s=o.cameraObject.position.x-o.cameraObject.target.x,c=o.cameraObject.position.y-o.cameraObject.target.y,u=o.cameraObject.position.z-o.cameraObject.target.z,l=1/Math.sqrt(s*s+c*c+u*u);s*=l,c*=l,u*=l;var d=[e,t,i],m=n/Math.tan(r*Math.PI/360),h=[e+s*m,t+c*m,i+u*m],p=m+a,f=0;f=a>.95*m?(1-.95)*m:m-a;var v=new Zinc.Viewport;return v.nearPlane=f,v.farPlane=p,v.eyePosition=h,v.targetPosition=d,v.upVector=[o.cameraObject.up.x,o.cameraObject.up.y,o.cameraObject.up.z],v},this.getDefaultViewport=function(){return b},this.getCurrentViewport=function(){var e=new Zinc.Viewport;return e.nearPlane=o.cameraObject.near,e.farPlane=o.cameraObject.far,e.eyePosition[0]=o.cameraObject.position.x,e.eyePosition[1]=o.cameraObject.position.y,e.eyePosition[2]=o.cameraObject.position.z,e.targetPosition[0]=o.cameraObject.target.x,e.targetPosition[1]=o.cameraObject.target.y,e.targetPosition[2]=o.cameraObject.target.z,e.upVector[0]=o.cameraObject.up.x,e.upVector[1]=o.cameraObject.up.y,e.upVector[2]=o.cameraObject.up.z,e},this.getDefaultEyePosition=function(){return eyePosition},this.getDefaultTargetPosition=function(){return targetPosition},this.cameraTransition=function(e,t,i){O=new Zinc.SmoothCameraTransition(e,t,o,i)},this.enableCameraTransition=function(){x=s},this.pauseCameraTransition=function(){x=r},this.stopCameraTransition=function(){x=r,O=void 0},this.isTransitioningCamera=function(){return x===s},this.autoTumble=function(e,t,i){_=new Zinc.CameraAutoTumble(e,t,i,o)},this.enableAutoTumble=function(){x=c},this.stopAutoTumble=function(){x=r,_=void 0},this.enableRaycaster=function(e,t,i){void 0==C&&(C=new Zinc.RayCaster(e,t,i,o.renderer))},this.disableRaycaster=function(){C.disable(),C=void 0},this.updateAutoTumble=function(){_&&(_.requireUpdate=!0)},this.isAutoTumble=function(){return x===c},this.enable()},t.SmoothCameraTransition=function(e,t,i,n){var o=e.eyePosition,r=e.targetPosition,a=t.eyePosition,s=t.targetPosition,c=i,u=this,l=n,d=0,m=!1;c.near=Math.min(e.nearPlane,t.nearPlane),c.far=Math.max(e.farPlane,t.farPlane);this.update=function(e){var t,i,n;!1!==u.enabled&&(!function(e){var t=d+e;t>l&&(t=l),d=t}(e),t=d/l,i=[o[0]*(1-t)+a[0]*t,o[1]*(1-t)+a[1]*t,o[2]*(1-t)+a[2]*t],n=[r[0]*(1-t)+s[0]*t,r[1]*(1-t)+s[1]*t,r[2]*(1-t)+s[2]*t],c.cameraObject.position.set(i[0],i[1],i[2]),c.cameraObject.target.set(n[0],n[1],n[2]),d==l&&(m=!0))},this.isTransitionCompleted=function(){return m}},t.RayCaster=function(e,t,i,n){var o=e,r=n,a=t,s=i,c=new d.Raycaster,u=new d.Vector2;this.enable=function(){enable=!0},this.disable=function(){enable=!1};var l=function(e,t,i){var n=e.domElement.getBoundingClientRect();u.x=(t-n.left)/n.width*2-1,u.y=-(i-n.top)/n.height*2+1;var a=o.getThreeJSScene();return r.render(a,e.cameraObject),c.setFromCamera(u,e.cameraObject),c.intersectObjects(a.children,!0)};this.pick=function(e,t,i){if(r&&o&&e&&a){var n=l(e,t,i);a(n,t,i)}},this.move=function(e,t,i){if(r&&o&&e&&s){var n=l(e,t,i);s(n,t,i)}}},t.CameraAutoTumble=function(e,t,i,n){var o=new d.Vector3,r=-t,a=n,s=this,c=e;this.stopOnCameraInput=i,this.requireUpdate=!0;this.update=function(e){!1!==s.enabled&&(s.requireUpdate&&(!function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]),i=.25*(4*Math.abs(e[0])+4*Math.abs(e[1])),n=-e[1]/t,r=e[0]/t,s=n*e[0]+r*-e[1];s>i?s=i:s<-i&&(s=-i);var c=Math.acos(s/i)-.5*Math.PI,u=new d.Vector3(a.cameraObject.position.x-a.cameraObject.target.x,a.cameraObject.position.y-a.cameraObject.target.y,a.cameraObject.position.z-a.cameraObject.target.z);u.normalize();var l=new d.Vector3(a.cameraObject.up.x,a.cameraObject.up.y,a.cameraObject.up.z);l.normalize();var m=new d.Vector3;m.crossVectors(l,u),m.normalize();var h=new d.Vector3(n*m.x+r*l.x,n*m.y+r*l.y,n*m.z+r*l.z);o.x=Math.sin(c)*u.x+Math.cos(c)*h.x,o.y=Math.sin(c)*u.y+Math.cos(c)*h.y,o.z=Math.sin(c)*u.z+Math.cos(c)*h.z}(c),s.requireUpdate=!1),a.rotateAboutLookAtpoint(o,r))}},d.StereoCameraZoomFixed=function(){this.type="StereoCamera",this.aspect=1,this.cameraL=new d.PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new d.PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1},Object.assign(d.StereoCameraZoomFixed.prototype,{update:(u=new d.Matrix4,l=new d.Matrix4,function(e){if(n!==e.focus||o!==e.fov||r!==e.aspect*this.aspect||a!==e.near||s!==e.far||c!==e.zoom){n=e.focus,o=e.fov,r=e.aspect*this.aspect,a=e.near,s=e.far,c=e.zoom;var t,i,m=e.projectionMatrix.clone(),h=.032*a/n,p=a*Math.tan(d.Math.DEG2RAD*o*.5)/e.zoom;l.elements[12]=-.032,u.elements[12]=.032,t=-p*r+h,i=p*r+h,m.elements[0]=2*a/(i-t),m.elements[8]=(i+t)/(i-t),this.cameraL.projectionMatrix.copy(m),t=-p*r-h,i=p*r-h,m.elements[0]=2*a/(i-t),m.elements[8]=(i+t)/(i-t),this.cameraR.projectionMatrix.copy(m)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(l),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(u)})}),d.StereoEffect=function(e){var t=new StereoCameraZoomFixed;t.aspect=.5,this.setSize=function(t,i){e.setSize(t,i)},this.render=function(i,n){i.updateMatrixWorld(),null===n.parent&&n.updateMatrixWorld(),t.update(n);var o=e.getSize();e.setScissorTest(!0),e.clear(),e.setScissor(0,0,o.width/2,o.height),e.setViewport(0,0,o.width/2,o.height),e.render(i,t.cameraL),e.setScissor(o.width/2,0,o.width/2,o.height),e.setViewport(o.width/2,0,o.width/2,o.height),e.render(i,t.cameraR),e.setScissorTest(!1)}},ModifiedDeviceOrientationControls=function(e){var t=this;this.object=e,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0;var i,n,o,r,a=function(e){t.deviceOrientation=e},s=function(){t.screenOrientation=window.orientation||0},c=(i=new d.Vector3(0,0,1),n=new d.Euler,o=new d.Quaternion,r=new d.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),function(e,t,a,s,c){var u=new d.Vector3(0,0,1);u.subVectors(e.target,e.position),n.set(a,t,-s,"YXZ");var l=new d.Quaternion;l.setFromEuler(n),l.multiply(r),l.multiply(o.setFromAxisAngle(i,-c)),u.applyQuaternion(l),u.addVectors(e.position,u),e.lookAt(u)});this.connect=function(){s(),window.addEventListener("orientationchange",s,!1),window.addEventListener("deviceorientation",a,!1),t.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",s,!1),window.removeEventListener("deviceorientation",a,!1),t.enabled=!1},this.update=function(){if(!1!==t.enabled){var e=t.deviceOrientation.alpha?d.Math.degToRad(t.deviceOrientation.alpha):0,i=t.deviceOrientation.beta?d.Math.degToRad(t.deviceOrientation.beta):0,n=t.deviceOrientation.gamma?d.Math.degToRad(t.deviceOrientation.gamma):0,o=t.screenOrientation?d.Math.degToRad(t.screenOrientation):0;c(t.object,e,i,n,o)}},this.dispose=function(){this.disconnect()},this.connect()}},function(e,t){function i(e,t,i,n){var o=new XMLHttpRequest;o.open("GET",e,!0),o.onreadystatechange=function(){4==o.readyState&&(200==o.status?i(o.responseText,t):n(e))},o.send(null)}t.loadExternalFile=i,t.loadExternalFiles=function(e,t,n){var o=e.length,r=0,a=[];function s(e,i){a[i]=e,++r==o&&t(a)}for(var c=0;c<o;c++)i(e[c],c,s,n)}}])});